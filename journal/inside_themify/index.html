 <!DOCTYPE html>
<html lang="en">
 <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D00k &nbsp;â€¢  A Look Inside Themify </title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="shortcut icon" type="image/png" href="/img/assets/favicon.png">
    <link rel="me" href="https://post.lurk.org/@dook">
    <meta property="og:image" content="/img/journal/themify_03.png" />
    <meta property="og:description" 
  content="A technical dive into the workings of my customisable iPod theme Themify." />
 </head>

 
 <body>
  <header class="journal colours">
    
<div>
<nav>
<ul class="name">
	  	<li>
  		<a class="name" href="/">ðŸ—¦DookðŸ—§</a>
  	</li>
</ul>
  <ul role="list">
  
   
    <li>
      <a class="" href="/gallery/">
        Gallery
      </a>
    </li>
  
   
    <li>
      <a class="" href="/projects/">
        Projects
      </a>
    </li>
  
   
    <li>
      <a class="" href="/knowledge/">
        Knowledge
      </a>
    </li>
  
   
    <li>
      <a class="active" href="/journal/">
        Journal
      </a>
    </li>
  
   
    <li>
      <a class="" href="/about/">
        About
      </a>
    </li>
   
</ul>
</nav> 
</div>

  </header>
   <main>
    <h1 class="title">A Look Inside Themify</h1>
          
        <ul class="tags">
          
          <li><a class="round-button" href="/tags/ipod/">ipod</a></li>
          
          <li><a class="round-button" href="/tags/design/">design</a></li>
          
        </ul>
      
     <hr>
    <figure>
 	<div>
     <img src="/img/journal/themify_03.png" loading="lazy" alt="Themify Wallpaper poster">
     <figcaption></figcaption>
     
 	</div>
 </figure>
<p>After a few months of working on and off, I finally finished my next Rockbox theme: Themify. Themify does a lot of things I haven&rsquo;t done yet in Rockbox, I really tried to push myself to create something cool and unique and I think the results definitely speak for themselves! This time, I decided to make a post here going over some of these features and generally looking into the code a bit more for those who are interested in that kind of thing.</p>
<h2 id="ui-re-colouring">UI Re-colouring</h2>
<p>Of course, the main feature of Themify is the ability to completely colour-customise the interface to your taste. This is done by taking full advantage of Rockbox&rsquo;s built in colour settings. Many theme tags support using these user-set default colours, and there&rsquo;s even ways to make bitmap images be drawn with these too. The goal of Themify was to take these to the extreme</p>
<h3 id="transparency">Transparency</h3>
<p>One feature of Rockbox theming that has fascinated me for a while is transparent bitmaps. With regular bitmaps, a form of transparent masking is supported (and used fairly often), however Rockbox also supports <em>true</em> transparent bitmaps. I could only find a handful of themes that used this feature in albeit tiny amounts, it&rsquo;s quite costly in terms of resources, but I felt that the iPod could handle it in larger scales. For Themify, transparent elements provide a vital accent colour for the interface. And thanks to some changes to background drawing, I was able to use it in plenty of places.</p>
<h3 id="the-backgrounds">The Backgrounds</h3>
<p>In recent years, background image switching has become a core part of modern themes. This utilises a layer drawn in the background, where logic is used to display different images per screen. This works great, however even with the best compression you can achieve, each image will come in at around 80Kbs. While this isn&rsquo;t much, over 5 or 6 images it can begin to threaten the file size of your theme over Rockbox&rsquo;s theme site&rsquo;s limits. Instead of taking the standard approach, I decided to try drawing the background elements using theme tags. This involved drawing rectangles in many places and using images to make up for rounded parts, accents and so on. This saved an incredible amount of space and let me use transparent bitmaps far more frivolously.</p>
<figure>
 	<div>
     <img src="/img/journal/themify_01.jpg" loading="lazy" alt="A comparison of the player and it&#39;s backdrop drawing">
     <figcaption>The player screen&#39;s background drawing visualised.</figcaption>
     <hr>
 	</div>
 </figure>
<h3 id="1-bit-bitmaps">1-bit Bitmaps</h3>
<p>One massive space savings was made with icons and other re-coloured UI images. Converting them to 1-bit Bitmaps gave the same result as regular bitmaps, but at a fraction of the size and effort to load. Without this one decision, I don&rsquo;t think Themify would have performed as well as it did.</p>
<h2 id="adaptive-ui">Adaptive UI</h2>
<p>To keep a clean, consistent UI, I aimed to create various dynamic features that would give users the information they need when it&rsquo;s needed, and hide it when not. The main place you can see this is with my icon bar for lossless audio, shuffle and repeat indicators. This uses a rather large amount of basic logic to decide what positions icons should be drawn in and when, and the result is well integrated into theme. I think you&rsquo;d hardly notice what it&rsquo;s doing unless you knew.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">#An example of the logic for one icon positions
</span></span><span class="line"><span class="cl">%?and(%if(%ps, =, 1),%if(%mm, =, 1),%or(%if(%fc, !=, 4),%if(%fc, !=, 5),%if(%fc, !=, 7),%if(%fc, !=, 11),%if(%fc, !=, 13)))&lt;%xd(statusextra,3)&gt;
</span></span><span class="line"><span class="cl">%?and(%if(%ps, !=, 1),%if(%mm, &gt;, 1),%or(%if(%fc, !=, 4),%if(%fc, !=, 5),%if(%fc, !=, 7),%if(%fc, !=, 11),%if(%fc, !=, 13)))&lt;%xd(statusextra,3)&gt;
</span></span><span class="line"><span class="cl">%?and(%if(%ps, !=, 1),%if(%mm, =, 1),%or(%if(%fc, =, 4),%if(%fc, =, 5),%if(%fc, =, 7),%if(%fc, =, 11),%if(%fc, =, 13)))&lt;%xd(statusextra,3)&gt;
</span></span></code></pre></div><p>I also added automatic line splitting to the song title text and playlist position indicator. The song title is a bit imperfect, I detect the length of the title, and if it fits the necessary parameters then it will be displayed in two lines. I intended for this feature to be smarter, splitting the text in a way that respected words and didnt chop them up, however Rockbox theme files are unable to detect space characters, stopping this feature in it&rsquo;s tracks.</p>
<figure>
 	<div>
     <img src="/img/journal/themify_02.jpg" loading="lazy" alt="Examples of adaptive elements in the ui">
     <figcaption></figcaption>
     
 	</div>
 </figure>
<h2 id="the-lockscreen">The Lockscreen</h2>
<p>Easily my favourite feature, Themify&rsquo;s lockscreen is my most impressive yet. Using a full screen transparent bitmap for the background, it looks stunning. I also added the largest analog clock attempted in Rockbox to date. Using the newer image loading logic, I was able to keep at least the hour hand&rsquo;s code small. I had to compromise with the minute hands since they couldn&rsquo;t be 1-bit bitmaps, and to have 60 individual hands produced a massive file size. I kept the logic as small as I could however, so the result isn&rsquo;t actually half bad, especially compared to other attempts at this feature.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">#--- Lockscreen Clock ---#
</span></span><span class="line"><span class="cl">%Vl(Lockscreen,15,40,160,160,-)
</span></span><span class="line"><span class="cl">%xd(HourHands,%cl)
</span></span><span class="line"><span class="cl">#
</span></span><span class="line"><span class="cl">%Vl(Lockscreen,89,40,86,86,-)
</span></span><span class="line"><span class="cl">%?and(%if(%cM, &gt;=, 0),%if(%cM, &lt;, 5))&lt;%xd(MinuteHands,1)&gt;
</span></span><span class="line"><span class="cl">%?and(%if(%cM, &gt;=, 5),%if(%cM, &lt;, 10))&lt;%xd(MinuteHands,2)&gt;
</span></span><span class="line"><span class="cl">%?and(%if(%cM, &gt;=, 10),%if(%cM, &lt;, 15))&lt;%xd(MinuteHands,3)&gt;
</span></span><span class="line"><span class="cl">%?and(%if(%cM, &gt;=, 15),%if(%cM, &lt;, 20))&lt;%xd(MinuteHands,4)&gt;
</span></span><span class="line"><span class="cl">%Vl(Lockscreen,89,114,86,86,-)
</span></span><span class="line"><span class="cl">%?and(%if(%cM, &gt;=, 20),%if(%cM, &lt;, 25))&lt;%xd(MinuteHands,5)&gt;
</span></span><span class="line"><span class="cl">#... and so on 
</span></span></code></pre></div><p>This implementation also features a fix for an issue that has long plagued Lockscreen designs. When the song switches to the next, if a Lockscreen is open, it will refresh the menu the Lockscreen is drawn over. This creates a glitchy mess, and stops this feature from being any more than a neat tech demo. However, I finally fixed this (literally just before I launched the theme) by drawing a viewport over the main menu whenever a song changes, effectively refreshing the Lockscreen effect.</p>
<h2 id="final-thoughts">Final Thoughts</h2>
<p>Overall, I&rsquo;m quite happy and proud of this theme&rsquo;s outcome. I hope many people will find joy in being able to change their colour scheme to fit themselves, or however they feel, whenever they want. If you enjoy Themify, feel free to send some feedback or suggest improvements in the <a href="https://github.com/D0-0K/themify/discussions" target="_blank" rel="noopener">github discussions</a>!</p>
<h2 id="links">Links</h2>


<ul class="extra">
	<li>
	   <a href="/journal/inside_themify">âˆ™ Themify Web Page</a>.
	</li>
	<li>
	   <a href="https://github.com/D0-0K/themify" target="_blank" rel="noreferrer">â¬© Github Repository</a>.
	</li>
	<li>
	   <a href="https://themes.rockbox.org/index.php?themeid=3320&amp;target=ipodvideo" target="_blank" rel="noreferrer">â¬© Rockbox Theme page</a>.
	</li>


    <div class="back">
     <a class="prev" href="/journal">âŒ© Back to Journal</a>
   </div>
  </main>
 </body>

 <footer>
  <hr>
       <a href="https://webring.xxiivv.com/#d00k" target="_blank" alt="webring">
        <svg fill="var(--text)" stroke="var(--text)" stroke-linecap="square" stroke-width="28" xmlns="http://www.w3.org/2000/svg" viewBox="0 -15 300 300" height="40" width="40">
                            &gt;
                            <path d="M201.962 210a60 60 0 10-103.924-60l-50 86.603" fill="var(--background)" stroke="var(--text)"></path>
                            <path d="M98.038 210a60 60 0 10103.924-60l-50-86.603" fill="var(--background)" stroke="var(--text)"></path>
                            <path d="M150 120a60 60 0 100 120h100" fill="var(--background)" stroke="var(--text)"></path>
                            &lt; <circle xmlns="http://www.w3.org/2000/svg" fill="var(--background)" r="60" stroke="var(--text)" cx="150" cy="180" stroke-width="28"></circle>
                        </svg>
      </a>
      <a href="/index.xml" target="_blank" alt="RSS Feed">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 210 210" height="34" width="34" stroke-width="10" stroke="var(--text)" fill="var(--text)"><path d="M30,45 A15,15 0 0,1 15,30 A15,15 0 0,1 30,15 A150,150 0 0,1 180,165 A15,15 0 0,1 165,180 A15,15 0 0,1 150,165 A120,120 0 0,0 30,45 M30,105 A15,15 0 0,1 15,90 A15,15 0 0,1 30,75 A90,90 0 0,1 120,165 A15,15 0 0,1 105,180 A15,15 0 0,1 90,165 A60,60 0 0,0 30,105 M30,135 A30,30 0 0,1 60,165 A30,15 0 0,1 30,180 A15,15 0 0,1 15,165 A15,30 0 0,1 30,135 "></path></svg>
      </a>
      <a href="https://github.com/D0-0K" target="_blank" alt="github">
        <svg viewBox="0 0 140 140" xmlns="http://www.w3.org/2000/svg" height="34" width="34"><path style="fill: var(--text);" d="M63.994.152C28.66.152 0 28.806 0 64.158c0 28.272 18.336 52.26 43.768 60.726 3.2.586 4.37-1.392 4.37-3.084 0-1.52-.06-5.544-.092-10.888-17.8 3.87-21.56-8.576-21.56-8.576-2.906-7.394-7.102-9.364-7.102-9.364-5.812-3.972.44-3.888.44-3.888 6.424.452 9.8 6.592 9.8 6.592 5.712 9.784 14.984 6.96 18.63 5.32.58-4.14 2.234-6.96 4.06-8.56-14.21-1.612-29.15-7.104-29.15-31.63 0-6.984 2.494-12.7 6.588-17.172-.66-1.62-2.856-8.12.628-16.932 0 0 5.374-1.72 17.6 6.56 5.104-1.42 10.58-2.128 16.02-2.152 5.44.024 10.914.734 16.024 2.154 12.22-8.28 17.58-6.56 17.58-6.56 3.496 8.81 1.3 15.316.64 16.936 4.104 4.476 6.58 10.19 6.58 17.174 0 24.586-14.966 30-29.22 31.58 2.296 1.98 4.34 5.88 4.34 11.854 0 8.556-.076 15.46-.076 17.56 0 1.706 1.154 3.7 4.4 3.074C109.68 116.396 128 92.42 128 64.156 128 28.808 99.344.152 63.994.152z"/></svg>
      </a>   
      <div style="float:right;">
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
      </div> 
   </footer>